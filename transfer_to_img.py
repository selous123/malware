#coding:utf-8
import numpy as np
import os
import math
from PIL import Image
import csv
from collections import defaultdict
size = 512,512

#generate label dict
def generate_label_dict():
    labelDict = defaultdict(int)
    fp = open("trainLabels.csv","r")
    labels = csv.reader(fp)

    for lineNum,label in enumerate(labels):
        if lineNum!=0:
            labelDict[label[0]] = label[1]
    return labelDict

#transform byte file to image
def transform_to_img(path):
    f = open(path,'rb')
    vector = []
    for line in f:
        line = line.replace("\r\n","")
        elements = line.split(" ")
        del elements[0]
        vector.extend(elements)
        #raw_input("wait")
    #print len(vector)
    vector = filter(lambda x:x !="??",vector)
    width = int(math.floor(math.sqrt(len(vector))))
    vector = [int(i,16) for i in vector]
    img = Image.fromarray(np.resize(np.uint8(np.array(vector)),(width,width)))
    
    #compress
    img = img.resize((size),Image.ANTIALIAS)
    #print img
    #io.imsave("img/"+path.split("/")[1].split(".")[0]+".jpg",img)
    
    labelDict = generate_label_dict()
    file_name = path.split("/")[1].split(".")[0]
    img.save("img/"+labelDict[file_name]+"_"+file_name+".jpg")

def readFile(dirPath):
    paths = os.listdir(dirPath)
    print paths[0]
    for path in paths:
        transform_to_img(dirPath+'/'+path)

if __name__=='__main__':
    readFile("train")